{% extends "base.html" %}

{% block title %}Resultado ¬∑ Reto Diario{% endblock %}

{% block extra_head %}
<style>
  :root{ --line:#e5e7eb; --muted:#6b7280; --ink:#111827; }

  .result-shell{ max-width:760px; margin:0 auto; }
  .result-shell h1{ margin:0 0 8px; }

  /* --- Bloque principal (mascota + bocadillo) --- */
  .reveal{ display:flex; align-items:flex-start; gap:clamp(10px,2.5vw,20px); margin:8px 0 16px; }
  .mascota{ width:clamp(72px,16vw,120px); height:auto; filter:drop-shadow(0 4px 10px rgba(0,0,0,.12)); flex-shrink:0; }
  .bocadillo{
    flex:1; background:#fff; border:1px solid var(--line); border-radius:16px;
    padding:clamp(10px,2.2vh,16px) clamp(12px,2.6vw,18px);
    box-shadow:0 6px 24px rgba(2,6,23,.06); position:relative;
  }
  .bocadillo::before{
    content:""; position:absolute; left:-10px; top:18px;
    border:10px solid transparent; border-right-color:var(--line);
  }
  .bocadillo::after{
    content:""; position:absolute; left:-8px; top:20px;
    border:8px solid transparent; border-right-color:#fff;
  }

  .big{ font-weight:800; margin:0 0 6px; }
  .subtitle{ margin:0 0 6px; color:#334155; font-weight:700; }
  .correctas{ margin:.25rem 0 .25rem 1rem; padding:0; }
  .correctas li{ list-style:none; margin:2px 0; color:#065f46; font-weight:700; }

  .elegidas{
    display:flex; gap:12px; align-items:flex-start;
    background:#fff7ed; border:1px solid #fed7aa; color:#9a3412;
    border-radius:14px; padding:10px 12px; margin-top:8px;
  }
  .elegidas .ff-title{ font-weight:800; margin-bottom:2px; }

  .funfact{
    display:flex; gap:12px; align-items:flex-start;
    background:#f8fafc; border:1px solid var(--line);
    border-radius:14px; padding:12px 14px; margin-top:10px;
  }
  .ff-icon{ font-size:1.3rem; line-height:1; }
  .ff-title{ font-weight:800; margin-bottom:2px; }
  .ff-text{ color:#334155; }

  /* --- Rel√°mpago: pila de 3 bloques --- */
  .relampago-stack{ display:grid; gap:14px; margin:8px 0 16px; }
  .relampago-item .header-row{ display:flex; align-items:center; gap:10px; margin:0 0 4px; }
  .tag{
    display:inline-flex; align-items:center; gap:.4rem;
    border:1px solid var(--line); border-radius:999px;
    padding:.18rem .6rem; font-weight:800; font-size:.75rem; color:#334155; background:#f8fafc;
  }
  .ok { color:#065f46; }
  .bad{ color:#b91c1c; }

  /* --- CTA / acciones --- */
  .actions{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:16px; }
  .actions .btn{
    width:100%; box-sizing:border-box; display:flex; align-items:center; justify-content:center; gap:8px;
    min-height:48px; font-weight:800; font-size:.95rem; border-radius:12px;
  }

  @media (max-width:560px){
    .reveal{ flex-direction:column; align-items:center; }
    .bocadillo::before, .bocadillo::after{ display:none; }
  }
</style>
{% endblock %}

{% block content %}
<div class="result-shell">

  {# ================= MODO REL√ÅMPAGO ================= #}
  {% if bloques_relampago %}
    <h1>‚ö° Ronda rel√°mpago</h1>

    <div class="relampago-stack" aria-label="Resumen de tus resultados por pregunta">
      {% for b in bloques_relampago %}
        <section class="relampago-item">
          <div class="header-row">
            <span class="tag">{{ b.titulo }}</span>
            {% if b.correcto is not none %}
              <span class="{{ 'ok' if b.correcto else 'bad' }}">
                {% if b.correcto %}‚úÖ ¬°Correcto!{% else %}‚ùå No era esa‚Ä¶{% endif %}
              </span>
            {% endif %}
          </div>

          <div class="reveal">
            <img class="mascota" src="{{ ruta_mascota or url_for('static', filename='img/ATPPet-nerd-180.png') }}" alt="Mascota">
            <div class="bocadillo">
              {% if b.correcto %}
                <p class="big">¬°Bien hecho! üëè</p>
              {% else %}
                <p class="big">La respuesta correcta es:</p>
              {% endif %}

              {% if b.correctas %}
                <ul class="correctas">
                  {% for t in b.correctas %}
                    <li>‚úî {{ t }}</li>
                  {% endfor %}
                </ul>
              {% endif %}

              {% if b.elegidas and not b.correcto %}
              <div class="elegidas">
                <div class="ff-icon">üìù</div>
                <div>
                  <div class="ff-title">Tus elecciones</div>
                  <div class="ff-text">{{ b.elegidas | join(', ') }}</div>
                </div>
              </div>
              {% endif %}

              {% if b.fun_fact %}
              <div class="funfact">
                <div class="ff-icon">üí°</div>
                <div>
                  <div class="ff-title">Dato curioso</div>
                  <div class="ff-text">{{ b.fun_fact }}</div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </section>
      {% endfor %}
    </div>

    {% if mostrar_cta %}
    <div class="actions">
      <a class="btn primary-btn" href="{{ url_for('resultados.ver_resultados') }}">
        <i class="fa-solid fa-ranking-star"></i> Ver clasificaci√≥n
      </a>
    </div>
    {% endif %}

  {# ================= MODO NORMAL ================= #}
  {% else %}
    <h1>{% if correcto %}‚úÖ ¬°Correcto!{% else %}‚ùå No era esa‚Ä¶{% endif %}</h1>

    <div class="reveal">
      <img class="mascota" src="{{ ruta_mascota or url_for('static', filename='img/ATPPet-nerd-180.png') }}" alt="Mascota">
      <div class="bocadillo">
        {% if correcto %}
          <p class="big">¬°Bien hecho! üëè</p>
        {% else %}
          <p class="big">La respuesta correcta es:</p>
        {% endif %}

        {% if correctas %}
        <ul class="correctas">
          {% for t in correctas %}
            <li>‚úî {{ t }}</li>
          {% endfor %}
        </ul>
        {% endif %}

        {% if elegidas and not correcto %}
        <div class="elegidas">
          <div class="ff-icon">üìù</div>
          <div>
            <div class="ff-title">Tu elecci√≥n</div>
            <div class="ff-text">{{ elegidas | join(', ') }}</div>
          </div>
        </div>
        {% endif %}

        {% if fun_fact %}
        <div class="funfact">
          <div class="ff-icon">üí°</div>
          <div>
            <div class="ff-title">Dato curioso</div>
            <div class="ff-text">{{ fun_fact }}</div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="actions">
      <a class="btn primary-btn" href="{{ url_for('resultados.ver_resultados') }}">
        <i class="fa-solid fa-ranking-star"></i> Ver clasificaci√≥n
      </a>
    </div>
  {% endif %}

</div>
{% endblock %}
