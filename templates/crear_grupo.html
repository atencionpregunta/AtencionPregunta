<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Crear Grupo · Reto Diario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='img/ATPPet-32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='img/ATPPet-16.png') }}"
    />

    <!-- iOS / atajo a pantalla de inicio -->
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename='img/ATPPet-180.png') }}"
    />
    <style>
      .hint {
        font-size: 0.95rem;
        margin-top: 6px;
        min-height: 1.2em;
      }
      .hint.ok {
        color: #1e8543;
      }
      .hint.bad {
        color: #c62828;
      }
      .hint.neutral {
        color: #6b7280;
      }
      .btn[disabled] {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .grupos-usuario {
        margin-top: 20px;
      }
      .grupos-usuario ul {
        list-style: none;
        padding: 0;
      }
      .grupos-usuario li {
        margin: 6px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .inline input[type="checkbox"] {
        transform: scale(1.15);
      }
    </style>
  </head>
  <body>
    <main class="center-wrapper">
      <div class="card fade-in">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %} {% endif %} {% endwith %}
        <h1><i class="fa-solid fa-users-gear"></i> Crear Grupo</h1>

        <form
          method="POST"
          action="{{ url_for('grupos.crear_grupo') }}"
          class="formulario"
          id="form-crear-grupo"
          novalidate
        >
          <div class="form-group">
            <label for="nombre_grupo">Nombre del grupo:</label>
            <input
              type="text"
              name="nombre_grupo"
              id="nombre_grupo"
              required
              autocomplete="off"
            />
            <div id="nombre_hint" class="hint neutral">
              Escribe un nombre de grupo.
            </div>
          </div>

          <div class="form-group">
            <label for="contrasena_grupo">Contraseña (opcional):</label>
            <input
              type="password"
              name="contrasena_grupo"
              id="contrasena_grupo"
            />
          </div>

          <div class="form-group">
            <label for="tipo_grupo">Tipo de grupo:</label>
            <select name="tipo_grupo" id="tipo_grupo" required>
              <option value="publico">Público</option>
              <option value="privado">Privado</option>
            </select>
          </div>

          <!-- SWITCH: habilitar final de temporada -->
          <div class="form-group">
            <label
              class="inline"
              for="fin_temporada_enabled"
              style="display: flex; align-items: center; gap: 0.6rem"
            >
              <input type="checkbox" id="duracion_enabled"
              name="duracion_enabled" {% if request.form.get('duracion_enabled')
              %}checked{% endif %}> ¿Limitar temporada por duración?
            </label>
            <div class="hint neutral">
              Actívalo para fijar una duración en días (p. ej., 30).
            </div>
          </div>

          <!-- INPUT: duración (días). Solo visible si el switch está activo -->
          <div class="form-group" id="duracion_wrap" style="display: none">
            <label for="duracion_dias">Duración (días):</label>
            <input
              type="number"
              name="duracion_dias"
              id="duracion_dias"
              min="1"
              max="365"
              step="1"
              inputmode="numeric"
              value="{{ request.form.get('duracion_dias', '30') }}"
            />
            <div class="hint neutral">Entre 1 y 365 días.</div>
          </div>

          <button type="submit" class="btn primary-btn" id="btn-crear" disabled>
            <i class="fa-solid fa-plus"></i> Crear grupo
          </button>
          <a href="{{ url_for('index') }}" class="btn secondary-btn"
            >⬅️ Volver al inicio</a
          >
        </form>

        {% if grupos_usuario %}
        <div class="grupos-usuario">
          <h3>Tus grupos actuales</h3>
          <ul>
            {% for grupo in grupos_usuario %}
            <li><i class="fa-solid fa-users"></i> {{ grupo.codigo }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </main>
    <footer>
      <p>&copy; 2025 · Atencion Pregunta / Iker Angel</p>
    </footer>
  </body>
<script>
  function renderLista(items){
    const listEl = document.getElementById("publicos_list");
    if (!items.length){
      listEl.innerHTML = '<tr><td colspan="3" class="hint neutral">No hay resultados.</td></tr>';
      return;
    }
    listEl.innerHTML = "";
    for (const g of items){
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.textContent = g.codigo ?? "";

      const tdCount = document.createElement("td");
      tdCount.textContent = Number(g.miembros ?? 0) + " " + (Number(g.miembros ?? 0) === 1 ? "miembro" : "miembros");

      const tdBtn = document.createElement("td");
      const btn = document.createElement("button");
      btn.className = "btn primary-btn btn-sm";
      btn.type = "button";
      btn.textContent = "Unirse";
      btn.addEventListener("click", () => {
        document.getElementById("codigo_grupo").value = g.codigo;
        document.querySelector('form[action="{{ url_for("grupos.unirse_grupo") }}"]').submit();
      });
      tdBtn.appendChild(btn);

      tr.appendChild(tdName);
      tr.appendChild(tdCount);
      tr.appendChild(tdBtn);
      listEl.appendChild(tr);
    }
  }
</script>

</html>
