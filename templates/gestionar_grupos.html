{% extends "base.html" %}
{% set body_class = 'app-shell tone-soft page-grupos page-gestionar' %}
{% block title %}Gestionar grupos · Reto Diario{% endblock %}

{% block content %}
  <!-- Header -->
  <header class="flex items-center justify-between mb-4">
    <a href="{{ url_for('index') }}"
       class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-rose-100 bg-white hover:bg-neutral-50 text-sm">
      <i class="fa-solid fa-arrow-left"></i>
    </a>
    <h2 class="text-xl sm:text-2xl font-extrabold text-brand">
      <i class="fa-solid fa-gear"></i> Gestionar grupos
    </h2>
  </header>

  <!-- Flashes -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for category, message in messages %}
          {% set cls = 'bg-emerald-50 text-emerald-800 border-emerald-200' if category=='success'
                      else ('bg-red-50 text-red-800 border-red-200' if category in ['error','danger']
                      else 'bg-blue-50 text-blue-800 border-blue-200') %}
          <div class="px-4 py-2 rounded-xl border {{ cls }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Lista -->
  <div class="max-w-3xl mx-auto">
    {% if grupos_usuario and grupos_usuario|length %}
      <ul class="border border-rose-100 rounded-2xl overflow-hidden bg-white divide-y divide-rose-100">
        {% for grupo in grupos_usuario %}
        <li class="flex items-center justify-between gap-3 px-3 sm:px-4 py-2.5 hover:bg-neutral-50"
            x-data="{confirm:false}">
          <div class="min-w-0 flex items-center gap-2 font-semibold text-sm sm:text-base">
            <i class="fa-solid fa-users text-neutral-500"></i>
            <span class="truncate">{{ grupo.codigo }}</span>
          </div>

          <!-- Acciones -->
          <div class="flex items-center gap-2">
            <!-- Borrar con HTMX (progresivo) -->
            <form method="POST" action="{{ url_for('grupos.salir_grupo') }}"
                  class="contents"
                  @submit.prevent=" /* fallback si no hay HTMX */ confirm || (confirm=true)"
                  hx-post="{{ url_for('grupos.salir_grupo') }}"
                  hx-vals='{"id_grupo":"{{ grupo.id }}"}'
                  hx-target="closest li"
                  hx-swap="outerHTML"
                  hx-confirm="¿Seguro que quieres salirte del grupo «{{ grupo.codigo }}»?">
              <input type="hidden" name="id_grupo" value="{{ grupo.id }}">
              <button type="submit"
                      class="w-9 h-9 inline-flex items-center justify-center rounded-full border border-rose-200 text-red-700 bg-white hover:bg-red-50"
                      title="Salir del grupo">
                <i class="fa-solid fa-trash"></i>
              </button>
            </form>
          </div>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-neutral-700">No perteneces a ningún grupo todavía.</p>
    {% endif %}

    <!-- Acciones inferiores -->
    <div class="grid gap-2 mt-3 sm:grid-cols-2">
      <a href="{{ url_for('grupos.crear_grupo') }}"
         class="inline-flex items-center justify-center gap-2 px-5 h-11 rounded-full border border-rose-100 bg-white hover:bg-neutral-50">
        <i class="fa-solid fa-plus"></i> Crear grupo
      </a>
      <a href="{{ url_for('grupos.unirse_grupo') }}"
         class="inline-flex items-center justify-center gap-2 px-5 h-11 rounded-full border border-rose-100 bg-white hover:bg-neutral-50">
        <i class="fa-solid fa-right-to-bracket"></i> Unirse a grupo
      </a>
    </div>
  </div>
{% endblock %}
