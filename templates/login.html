{% extends "base.html" %}
{% set body_class = 'app-shell tone-soft page-auth' %}
{% block title %}Iniciar sesi√≥n ¬∑ Reto Diario{% endblock %}

{% block content %}
  <!-- Header -->
  <header class="flex items-center justify-between mb-4">
    <a href="{{ url_for('index') }}"
       class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-rose-100 bg-white hover:bg-neutral-50 text-sm">
      <i class="fa-solid fa-arrow-left"></i> Volver
    </a>
    <h2 class="text-xl sm:text-2xl font-extrabold text-brand">üîê Iniciar sesi√≥n</h2>
  </header>

  <!-- Flashes -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for category, message in messages %}
          {% set cls = 'bg-emerald-50 text-emerald-800 border-emerald-200' if category=='success'
                      else ('bg-red-50 text-red-800 border-red-200' if category in ['error','danger']
                      else 'bg-blue-50 text-blue-800 border-blue-200') %}
          <div class="px-4 py-2 rounded-xl border {{ cls }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Form -->
  <form method="POST" action="{{ url_for('auth.login') }}" novalidate class="space-y-4">
    <!-- Usuario -->
    <div>
      <label for="usuario" class="block font-semibold text-sm mb-1">Nombre de usuario</label>
      <input
        id="usuario" name="usuario" type="text" required autocomplete="username"
        value="{{ request.form.get('usuario','') }}"
        class="w-full h-11 px-4 rounded-full border border-rose-100 bg-white shadow-sm focus:outline-none focus:ring-4 focus:ring-rose-300"
        placeholder="Tu usuario" />
    </div>

    <!-- Contrase√±a (con toggle) -->
    <div x-data="{show:false}">
      <label for="contrasena" class="block font-semibold text-sm mb-1">Contrase√±a</label>
      <div class="relative">
        <input
          :type="show ? 'text' : 'password'"
          id="contrasena" name="contrasena" required autocomplete="current-password"
          class="w-full h-11 pl-4 pr-11 rounded-full border border-rose-100 bg-white shadow-sm focus:outline-none focus:ring-4 focus:ring-rose-300"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        <button type="button" @click="show=!show"
                class="absolute inset-y-0 right-0 px-3 text-neutral-600 hover:text-neutral-900"
                aria-label="Mostrar u ocultar contrase√±a">
          <i class="fa-solid" :class="show ? 'fa-eye-slash' : 'fa-eye'"></i>
        </button>
      </div>
    </div>

    <!-- Remember me -->
    <label class="inline-flex items-center gap-2 text-sm select-none">
      <input type="checkbox" name="remember"
             class="w-4 h-4 rounded border-neutral-300"
             {% if request.form.get('remember') %}checked{% endif %}>
      Recu√©rdame
    </label>

    <!-- Acciones -->
    <div class="grid gap-2 sm:grid-cols-[1fr_auto]">
      <button type="submit"
              class="inline-flex items-center justify-center gap-2 px-5 h-11 rounded-full text-white
                     bg-gradient-to-tr from-brand to-brand-dark shadow-md hover:shadow-lg transition">
        <i class="fa-solid fa-right-to-bracket"></i> Entrar
      </button>
    </div>
  </form>

  <!-- Divider -->
  <div class="my-4 border-t border-rose-100"></div>
  <p class="text-center text-sm text-neutral-600 mb-3">o bien</p>

  <!-- Login alternativo -->
  <div class="grid gap-2">
    <a href="{{ url_for('google.login') }}"
       class="inline-flex items-center justify-center gap-2 px-5 h-11 rounded-full border border-neutral-200 bg-white hover:bg-neutral-50">
      <i class="fa-brands fa-google text-[#ea4335]"></i> Iniciar sesi√≥n con Google
    </a>
    <a href="{{ url_for('index') }}"
       class="inline-flex items-center justify-center gap-2 px-5 h-11 rounded-full border border-rose-100 bg-white hover:bg-neutral-50">
      ‚¨ÖÔ∏è Volver al inicio
    </a>
  </div>
{% endblock %}

{% block scripts %}
<script>
  // Spinner ‚Äúr√°pido‚Äù al enviar
  document.addEventListener('submit', (e) => {
    const btn = e.target?.querySelector('button[type="submit"]');
    if (!btn) return;
    btn.insertAdjacentHTML('beforeend',
      '<span class="ml-2 inline-block w-4 h-4 border-2 border-white border-r-transparent rounded-full animate-spin"></span>');
  }, {capture:true});
</script>
{% endblock %}
