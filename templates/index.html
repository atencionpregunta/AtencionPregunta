{% extends "base.html" %}
{% set body_class = 'page-index' %}
{% block title %}Inicio ¬∑ Reto Diario{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
  <!-- HERO -->
  <section class="grid place-items-center text-center gap-2 mb-3">
    <img class="w-28 drop-shadow-md" src="{{ url_for('static', filename='img/ATPPet-180.png') }}" alt="Mascota">
    <h1 class="m-0 text-2xl sm:text-3xl font-extrabold text-brand">üö® Atenci√≥n Pregunta</h1>
    <div class="text-sm text-neutral-600 flex items-center justify-center gap-2">
      <i class="fa-solid fa-calendar-day"></i>
      <span>¬°Reto diario!</span>
    </div>
  </section>

  {% if session.get("usuario_id") %}
    <p class="text-center text-neutral-700 mb-2">
      Bienvenido, <strong>{{ session["usuario_nombre"] }}</strong> üëã
    </p>

    {% if grupo_actual %}
      {% if ya_respondido %}
        <p class="text-center">‚úÖ Ya has respondido a la pregunta de hoy.</p>
        <div class="grid gap-2 mt-3">
          <a href="{{ url_for('resultados.ver_resultados', id_grupo=id_grupo) }}"
             class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full text-white
                    bg-gradient-to-tr from-brand to-brand-dark shadow-md hover:shadow-lg transition">
            <i class="fa-solid fa-chart-simple"></i> Ver resultados
          </a>
          <a href="{{ url_for('grupos.gestionar_grupos') }}"
             class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                    bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
            <i class="fa-solid fa-gear"></i> Grupos
          </a>
        </div>
      {% else %}
        <div class="grid gap-2 mt-3">
          <form method="GET" action="{{ url_for('preguntas.ver_pregunta') }}" class="contents">
            <button type="submit"
                    class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full text-white
                           bg-gradient-to-tr from-brand to-brand-dark shadow-md hover:shadow-lg transition"
                    x-data @click="$el.dataset.loading='true'">
              <i class="fa-solid fa-bolt"></i> Vamos a por esa preguntilla
            </button>
          </form>
          <a href="{{ url_for('grupos.gestionar_grupos') }}"
             class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                    bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
            <i class="fa-solid fa-gear"></i> Grupos
          </a>
        </div>
      {% endif %}
    {% else %}
      <p class="text-center">‚ö†Ô∏è √önete o crea un grupo para participar.</p>
      <div class="grid gap-2 mt-3">
        <a href="{{ url_for('auth.login_form') }}"
           class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full text-white
                  bg-gradient-to-tr from-brand to-brand-dark shadow-md hover:shadow-lg transition">
          <i class="fa-solid fa-user-lock"></i> Iniciar sesi√≥n
        </a>
        <a href="{{ url_for('google.login') }}"
           class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                  bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
          <i class="fa-brands fa-google"></i> Iniciar con Google
        </a>
        <a href="{{ url_for('auth.crear_usuario') }}"
           class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                  bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
          <i class="fa-solid fa-user-plus"></i> Crear cuenta
        </a>
      </div>
    {% endif %}
  {% else %}
    <p class="text-center text-neutral-700 mb-2">Inicia sesi√≥n para continuar</p>
    <div class="grid gap-2">
      <a href="{{ url_for('auth.login_form') }}"
         class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full text-white
                bg-gradient-to-tr from-brand to-brand-dark shadow-md hover:shadow-lg transition">
        <i class="fa-solid fa-user-lock"></i> Iniciar sesi√≥n
      </a>
      <a href="{{ url_for('google.login') }}"
         class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
        <i class="fa-brands fa-google"></i> Iniciar con Google
      </a>
      <a href="{{ url_for('auth.crear_usuario') }}"
         class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-full
                bg-white border border-rose-100 text-neutral-900 hover:bg-neutral-50 transition">
        <i class="fa-solid fa-user-plus"></i> Crear cuenta
      </a>
    </div>
  {% endif %}
{% endblock %}

{% block floating %}
  {# El base.html ya incluye un bot√≥n de ayuda Alpine reutilizable;
     si quieres un texto espec√≠fico aqu√≠, descomenta y personaliza: #}
  {#
  <div x-data="{open:false}" class="fixed left-3 bottom-3 z-50">
    <button @click="open=!open" class="w-12 h-12 rounded-full bg-white text-brand border border-rose-200 shadow-lg hover:shadow-xl">
      <i class="fa-solid fa-question"></i>
    </button>
    <div x-show="open" x-transition
         class="mt-3 w-80 max-w-[92vw] bg-white rounded-2xl border border-rose-100 shadow-2xl p-4">
      <div class="font-extrabold text-brand mb-1">¬øC√≥mo funciona?</div>
      <ul class="text-sm text-neutral-600 space-y-1">
        <li>‚Ä¢ <b>Pregunta diaria</b> (hora Madrid).</li>
        <li>‚Ä¢ Respondes una vez; cambiar no punt√∫a.</li>
        <li>‚Ä¢ Mira la <b>clasificaci√≥n</b> en tu grupo.</li>
      </ul>
      <div class="mt-3 flex justify-end">
        <button @click="open=false" class="px-3 py-1.5 rounded-full bg-neutral-900 text-white text-sm">Entendido</button>
      </div>
    </div>
  </div>
  #}
{% endblock %}

{% block scripts %}
<script>
  // Efecto "loading" en el bot√≥n principal (usa dataset.loading en Tailwind si lo quieres cambiar)
  document.addEventListener('submit', (e) => {
    const btn = e.target?.querySelector('button[type="submit"]');
    if (!btn) return;
    btn.dataset.loading = 'true';
    // Spinner visual simple
    btn.insertAdjacentHTML('beforeend', '<span class="ml-2 inline-block w-4 h-4 border-2 border-white border-r-transparent rounded-full animate-spin"></span>');
  }, {capture:true});
</script>
{% endblock %}
